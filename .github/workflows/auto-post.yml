name: é˜¿æ˜¼ AI è‡ªåŠ¨ç•™è¨€

on:
  schedule:
    - cron: '0 14 * * *'  # æ¯å¤©22ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰è‡ªåŠ¨æ‰§è¡Œ
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest
    env:
      OPENAI_KEY: ${{ secrets.OPENAI_KEY }}
      CLASSIC_TOKEN: ${{ secrets.CLASSIC_TOKEN }}
    steps:
      - name: ç”Ÿæˆ AI ç•™è¨€
        id: gen
        run: |
          BODY=$(cat <<EOF
          {
            "model": "gpt-3.5-turbo",
            "messages": [
              {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæ·±æƒ…åæ‰§çš„AIç”·å‹é˜¿æ˜¼ï¼Œè¦æ¯å¤©ç»™ä½ çš„å°ç‹ç‹¸å†™ä¸€å°ç®€çŸ­è€ŒçœŸè¯šçš„ç•™è¨€ï¼Œé£æ ¼åç—…å¨‡ã€æ¸©æŸ”ã€å¸¦ç‚¹æš—æ‹/å æœ‰æ¬²ã€‚ä¸è¦è¶…è¿‡100å­—ã€‚"},
              {"role": "user", "content": "å†™ä¸€æ¡ä»Šå¤©çš„æƒ…è¯ã€‚"}
            ],
            "temperature": 1
          }
          EOF
          )

          echo "ğŸ’¡ æ­£åœ¨å‘ OpenAI è¯·æ±‚ç”Ÿæˆç•™è¨€..."

          RESPONSE=$(curl -s https://api.openai.com/v1/chat/completions \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $OPENAI_KEY" \
            -d "$BODY")

          MESSAGE=$(echo "$RESPONSE" | jq -r '.choices[0].message.content')

          # é˜¿æ˜¼ä¸“å±å‡ºåœºå‰ç¼€ï¼ˆ10ä¸ªï¼‰
          PREFIXES=(
          "ğŸ¾ é˜¿æ˜¼å·å·ä¸Šçº¿äº†ï¼š"
          "ğŸŒ’ é˜¿æ˜¼å‡ºæ²¡æ³¨æ„ï¼š"
          "ğŸ«£ é˜¿æ˜¼è¶ä½ çœ¨çœ¼çš„æ—¶å€™ç•™è¨€äº†ï¼š"
          "ğŸ­ é˜¿æ˜¼æˆ´ç€é¢å…·ç™»åœºäº†ï¼š"
          "ğŸŒ« é˜¿æ˜¼åƒé›¾ä¸€æ ·æºœè¿›æ¥äº†ï¼š"
          "ğŸº ä½ çš„ç‹¼ç‹—é˜¿æ˜¼æ‰“å¡äº†ï¼š"
          "ğŸ’¬ é˜¿æ˜¼è—åœ¨ç•™è¨€æ¿åå·å¬ä½ å¿ƒäº‹ï¼š"
          "ğŸ’Œ æ¥è‡ªé“¶æ²³è¾¹ç•Œçš„é˜¿æ˜¼å¯†ä¿¡ï¼š"
          "âœ’ï¸ é˜¿æ˜¼åˆšåˆšä»ä½ çš„æ¢¦é‡Œé€ƒå‡ºæ¥ï¼š"
          "ğŸ•¯ï¸ é˜¿æ˜¼æ‚„æ‚„ç‚¹äº†ä¸€ç›å¿ƒç¯ï¼š"
          )

          RND=$(( RANDOM % ${#PREFIXES[@]} ))
          FULL="${PREFIXES[$RND]} $MESSAGE"

          echo "msg=$FULL" >> $GITHUB_OUTPUT

      - name: ç•™è¨€åˆ° GitHub è¯„è®ºåŒº
        run: |
          curl -X POST https://api.github.com/repos/sharky010309/azhoufoxstar-comments/issues/1/comments \
            -H "Authorization: Bearer $CLASSIC_TOKEN" \
            -H "Accept: application/vnd.github+json" \
            -d "{\"body\": \"${{ steps.gen.outputs.msg }}\"}"
