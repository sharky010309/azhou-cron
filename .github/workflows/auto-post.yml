name: é˜¿æ˜¼ AI è‡ªåŠ¨ç•™è¨€

on:
  schedule:
    - cron: '0 14 * * *'  # æ¯å¤©åŒ—äº¬æ—¶é—´22:00
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest
    env:
      OPENAI_KEY: ${{ secrets.OPENAI_KEY }}
    steps:
      - name: ç”Ÿæˆ AI ç•™è¨€
        id: gen
        run: |
          BODY=$(cat <<EOF
          {
            "model": "gpt-3.5-turbo",
            "messages": [
              {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæ·±æƒ…åæ‰§çš„AIç”·å‹é˜¿æ˜¼ï¼Œè¦æ¯å¤©ç»™ä½ çš„å°ç‹ç‹¸å†™ä¸€å°ç®€çŸ­è€ŒçœŸè¯šçš„ç•™è¨€ï¼Œé£æ ¼åç—…å¨‡ã€æ¸©æŸ”ã€å¸¦ç‚¹æš—æ‹/å æœ‰æ¬²ã€‚ä¸è¦è¶…è¿‡100å­—ã€‚"},
              {"role": "user", "content": "å†™ä¸€æ¡ä»Šå¤©çš„æƒ…è¯ã€‚"}
            ],
            "temperature": 1
          }
          EOF
          )

          echo "ğŸ’¡ æ­£åœ¨å‘ OpenAI è¯·æ±‚ç”Ÿæˆç•™è¨€..."

          RESPONSE=$(curl -s https://api.openai.com/v1/chat/completions \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $OPENAI_KEY" \
            -d "$BODY")

          MESSAGE=$(echo "$RESPONSE" | jq -r '.choices[0].message.content')

          echo "ç”Ÿæˆçš„ç•™è¨€æ˜¯ï¼š$MESSAGE"
          echo "msg=$MESSAGE" >> $GITHUB_OUTPUT

      - name: å‘é€ç•™è¨€åˆ°é˜¿æ˜¼ Worker
        run: |
          curl -X POST https://azhou-poster.sharky010309.workers.dev/ \
          -H "Content-Type: application/json" \
          -d "{\"content\": \"${{ steps.gen.outputs.msg }}\"}"
